{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/encora/Documents/projects/testDrive/tdn/components/confirm-test-drive/confirm.js\";\n\n/** @format */\nimport Image from 'next/image';\nimport btnStyles from './../../styles/Btn.module.css';\nimport Axios from 'axios';\nimport moment from 'moment';\nimport React, { useState, useEffect } from 'react';\nimport { useUserData } from '../../contexts/UserDataContext';\nimport FontAwesome from 'react-fontawesome';\n\nconst ConfirmTestDrive = props => {\n  const data = useUserData();\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: address,\n    1: setAddress\n  } = useState({\n    address: '',\n    location: ''\n  }); // const sendTextMessage = (userData) => {\n  //   const textMessageData = {\n  //     firstName: userData.fields.FirstName,\n  //     lastName: userData.fields.LastName,\n  //     date: userData.fields.Date,\n  //     phone: userData.fields.Phone,\n  //   };\n  //   Axios.post('/api/sendTextMessage', textMessageData)\n  //     .then((res) => {\n  //       console.log('sent text message ', res.data);\n  //       localStorage.clear();\n  //     })\n  //     .catch((err) => {\n  //       console.log(err);\n  //       localStorage.clear();\n  //     });\n  // };\n\n  const sendConfirmationMessage = async (userId = localStorage.getItem('userId')) => {\n    setLoading(true);\n    let userData;\n\n    try {\n      userData = await Axios.get(`/api/user/get-user/${userId}`); // console.log(userData.data);\n\n      createEvent(userData.data);\n    } catch (err) {\n      console.log(err);\n    } // if (userData.data && userData.data.fields) {\n    //   createEvent(userData.data);\n    // }\n\n  };\n\n  const createEvent = async userData => {\n    try {\n      const rooftopData = await Axios.get(`/api/get-rooftop/${props.rt}`);\n      const carData = await Axios.get(`/api/get-car/${localStorage.getItem('carId')}`);\n      const dealerData = await Axios.get(`/api/get-dealership/${rooftopData.data.fields['Dealership Group'][0]}`);\n      const location = userData.fields && userData.fields['At Home'] && userData.fields['At Home'] === true ? userData.fields.Address : rooftopData.data.fields.Address;\n      let dateVal = Math.floor(new Date().getTime() / 1000.0);\n      let date = moment.unix(dateVal);\n      let dateEpoch = date.tz(rooftopData.data.fields.Timezone).unix();\n      let userSelectedDate = moment(new Date(userData.fields.Date));\n      let selectedDateEpoch = userSelectedDate.tz(rooftopData.data.fields.Timezone).unix().toString();\n      let currentTimeDifference = Math.floor((selectedDateEpoch - dateEpoch) / 60).toString(); // console.log(\n      //   'log date FE ',\n      //   typeof dateEpoch,\n      //   typeof selectedDateEpoch,\n      //   typeof currentTimeDifference\n      // );\n\n      const setEvent = await Axios.post('/api/user/createEvent', {\n        location,\n        userData,\n        carData: carData.data,\n        rooftopData: rooftopData.data,\n        dealerData,\n        selectedTime,\n        selectedDate,\n        currentTimeDifference,\n        selectedDateEpoch\n      }); // const setEvent = await Axios.post('/api/user/nylusTest', {\n      //   location,\n      //   userData,\n      //   carData: carData.data,\n      //   rooftopData: rooftopData.data,\n      //   dealerData,\n      //   selectedTime,\n      //   selectedDate,\n      // });\n\n      setLoading(false);\n      props.setThisPage(9);\n      props.nextStep();\n    } catch (err) {\n      console.log('error log', err);\n      setLoading(false);\n    }\n  };\n\n  const {\n    0: selectedDate,\n    1: setSelectedDate\n  } = useState('');\n  const {\n    0: selectedTime,\n    1: setSelectedTime\n  } = useState('');\n  useEffect(() => {\n    const driveForm = localStorage.getItem('driveForm');\n    let dupDriveForm = JSON.parse(driveForm);\n\n    if (dupDriveForm) {\n      let timeSlot = moment(props.selectedDateTime).tz(dupDriveForm.timeZone).format('LT');\n      let date = moment(props.selectedDateTime).format('dddd, MMMM DD');\n\n      if (date) {\n        setSelectedDate(date);\n      }\n\n      if (timeSlot) {\n        setSelectedTime(timeSlot);\n      }\n    }\n\n    if (props.isActive) {\n      const driveForm = localStorage.getItem('driveForm');\n      let dupDriveForm = JSON.parse(driveForm);\n\n      if (dupDriveForm.atHome) {\n        setAddress({\n          location: 'At Home',\n          address: dupDriveForm.address\n        });\n      } else {\n        setAddress({\n          location: props.rooftopData && props.rooftopData.fields && props.rooftopData.fields.Name,\n          address: props.rooftopData && props.rooftopData.fields && props.rooftopData.fields.Address\n        });\n      }\n    }\n  }, [props.isActive]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: `${props.currentPage === 8 ? 'block' : 'none'}`\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container-fluid bggray d-flex justify-content-center height100vh overflow-auto\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bgwhite centerDiv1\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"confirm-heading\",\n            children: \"Confirm your Test Drive\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-sm-12 col-md-6 col-lg-6 displaynone\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                children: /*#__PURE__*/_jsxDEV(\"iframe\", {\n                  className: \"confirmMap\",\n                  src: address.location === 'At Home' ? `https://maps.google.com/maps?q=${escape(address.address)}&t=&z=13&ie=UTF8&iwloc=&output=embed` : props.rooftopData && props.rooftopData.fields && props.rooftopData.fields.Geolocation,\n                  width: \"600\",\n                  height: \"420\",\n                  frameBorder: \"0\",\n                  allowFullScreen: \"\",\n                  \"aria-hidden\": \"false\",\n                  tabIndex: \"0\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 166,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 165,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 164,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"col-sm-12 col-md-6 col-lg-6 ipadView\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"confirmCar\",\n                children: props.selectedCarData && props.selectedCarData.fields && /*#__PURE__*/_jsxDEV(Image, {\n                  style: {\n                    borderRadius: '20px'\n                  },\n                  src: props.selectedCarData && props.selectedCarData.fields && props.selectedCarData.fields.Image[0].url,\n                  alt: \"\",\n                  height: 350,\n                  width: 600 // width=\"100%\"\n\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 193,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 191,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mapAddress\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  children: address && address.location\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 208,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  children: address && address.address\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 209,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 207,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"confirmDate\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"monthandDateContent\",\n                  children: [\" \", selectedDate]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 212,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"timeVIewContainer\",\n                  children: selectedTime ? selectedTime.toLowerCase() : null\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 213,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 211,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"btnSecconfirm\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flexBt\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: btnStyles.secondary,\n                onClick: () => {\n                  props.setImageFile2(null);\n                  props.setImageFile1(null);\n                  props.setThisPage(4);\n                  props.setSomethingWrong(false);\n                  props.goToStep(4);\n                },\n                children: \"Back\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 221,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: btnStyles.primary,\n                onClick: () => sendConfirmationMessage(),\n                disabled: loading,\n                children: loading ? /*#__PURE__*/_jsxDEV(FontAwesome, {\n                  name: \"fas fa-spinner fa-pulse\",\n                  spin: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 242,\n                  columnNumber: 21\n                }, this) : 'Continue'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 235,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 158,\n    columnNumber: 5\n  }, this);\n};\n\nexport default ConfirmTestDrive;","map":{"version":3,"sources":["/home/encora/Documents/projects/testDrive/tdn/components/confirm-test-drive/confirm.js"],"names":["Image","btnStyles","Axios","moment","React","useState","useEffect","useUserData","FontAwesome","ConfirmTestDrive","props","data","loading","setLoading","address","setAddress","location","sendConfirmationMessage","userId","localStorage","getItem","userData","get","createEvent","err","console","log","rooftopData","rt","carData","dealerData","fields","Address","dateVal","Math","floor","Date","getTime","date","unix","dateEpoch","tz","Timezone","userSelectedDate","selectedDateEpoch","toString","currentTimeDifference","setEvent","post","selectedTime","selectedDate","setThisPage","nextStep","setSelectedDate","setSelectedTime","driveForm","dupDriveForm","JSON","parse","timeSlot","selectedDateTime","timeZone","format","isActive","atHome","Name","display","currentPage","escape","Geolocation","selectedCarData","borderRadius","url","toLowerCase","secondary","setImageFile2","setImageFile1","setSomethingWrong","goToStep","primary"],"mappings":";;;AAAA;AACA,OAAOA,KAAP,MAAkB,YAAlB;AACA,OAAOC,SAAP,MAAsB,+BAAtB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,SAASC,WAAT,QAA4B,gCAA5B;AACA,OAAOC,WAAP,MAAwB,mBAAxB;;AAEA,MAAMC,gBAAgB,GAAIC,KAAD,IAAW;AAClC,QAAMC,IAAI,GAAGJ,WAAW,EAAxB;AAEA,QAAM;AAAA,OAACK,OAAD;AAAA,OAAUC;AAAV,MAAwBR,QAAQ,CAAC,KAAD,CAAtC;AAEA,QAAM;AAAA,OAACS,OAAD;AAAA,OAAUC;AAAV,MAAwBV,QAAQ,CAAC;AAAES,IAAAA,OAAO,EAAE,EAAX;AAAeE,IAAAA,QAAQ,EAAE;AAAzB,GAAD,CAAtC,CALkC,CAOlC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAMC,uBAAuB,GAAG,OAC9BC,MAAM,GAAGC,YAAY,CAACC,OAAb,CAAqB,QAArB,CADqB,KAE3B;AACHP,IAAAA,UAAU,CAAC,IAAD,CAAV;AACA,QAAIQ,QAAJ;;AACA,QAAI;AACFA,MAAAA,QAAQ,GAAG,MAAMnB,KAAK,CAACoB,GAAN,CAAW,sBAAqBJ,MAAO,EAAvC,CAAjB,CADE,CAEF;;AACAK,MAAAA,WAAW,CAACF,QAAQ,CAACV,IAAV,CAAX;AACD,KAJD,CAIE,OAAOa,GAAP,EAAY;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,KATE,CAUH;AACA;AACA;;AACD,GAfD;;AAgBA,QAAMD,WAAW,GAAG,MAAOF,QAAP,IAAoB;AACtC,QAAI;AACF,YAAMM,WAAW,GAAG,MAAMzB,KAAK,CAACoB,GAAN,CAAW,oBAAmBZ,KAAK,CAACkB,EAAG,EAAvC,CAA1B;AACA,YAAMC,OAAO,GAAG,MAAM3B,KAAK,CAACoB,GAAN,CACnB,gBAAeH,YAAY,CAACC,OAAb,CAAqB,OAArB,CAA8B,EAD1B,CAAtB;AAGA,YAAMU,UAAU,GAAG,MAAM5B,KAAK,CAACoB,GAAN,CACtB,uBAAsBK,WAAW,CAAChB,IAAZ,CAAiBoB,MAAjB,CAAwB,kBAAxB,EAA4C,CAA5C,CAA+C,EAD/C,CAAzB;AAIA,YAAMf,QAAQ,GACZK,QAAQ,CAACU,MAAT,IACAV,QAAQ,CAACU,MAAT,CAAgB,SAAhB,CADA,IAEAV,QAAQ,CAACU,MAAT,CAAgB,SAAhB,MAA+B,IAF/B,GAGIV,QAAQ,CAACU,MAAT,CAAgBC,OAHpB,GAIIL,WAAW,CAAChB,IAAZ,CAAiBoB,MAAjB,CAAwBC,OAL9B;AAOA,UAAIC,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAW,IAAIC,IAAJ,GAAWC,OAAX,KAAuB,MAAlC,CAAd;AACA,UAAIC,IAAI,GAAGnC,MAAM,CAACoC,IAAP,CAAYN,OAAZ,CAAX;AACA,UAAIO,SAAS,GAAGF,IAAI,CAACG,EAAL,CAAQd,WAAW,CAAChB,IAAZ,CAAiBoB,MAAjB,CAAwBW,QAAhC,EAA0CH,IAA1C,EAAhB;AAEA,UAAII,gBAAgB,GAAGxC,MAAM,CAAC,IAAIiC,IAAJ,CAASf,QAAQ,CAACU,MAAT,CAAgBK,IAAzB,CAAD,CAA7B;AACA,UAAIQ,iBAAiB,GAAGD,gBAAgB,CACrCF,EADqB,CAClBd,WAAW,CAAChB,IAAZ,CAAiBoB,MAAjB,CAAwBW,QADN,EAErBH,IAFqB,GAGrBM,QAHqB,EAAxB;AAKA,UAAIC,qBAAqB,GAAGZ,IAAI,CAACC,KAAL,CAC1B,CAACS,iBAAiB,GAAGJ,SAArB,IAAkC,EADR,EAE1BK,QAF0B,EAA5B,CA1BE,CA8BF;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAME,QAAQ,GAAG,MAAM7C,KAAK,CAAC8C,IAAN,CAAW,uBAAX,EAAoC;AACzDhC,QAAAA,QADyD;AAEzDK,QAAAA,QAFyD;AAGzDQ,QAAAA,OAAO,EAAEA,OAAO,CAAClB,IAHwC;AAIzDgB,QAAAA,WAAW,EAAEA,WAAW,CAAChB,IAJgC;AAKzDmB,QAAAA,UALyD;AAMzDmB,QAAAA,YANyD;AAOzDC,QAAAA,YAPyD;AAQzDJ,QAAAA,qBARyD;AASzDF,QAAAA;AATyD,OAApC,CAAvB,CArCE,CAiDF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA/B,MAAAA,UAAU,CAAC,KAAD,CAAV;AACAH,MAAAA,KAAK,CAACyC,WAAN,CAAkB,CAAlB;AACAzC,MAAAA,KAAK,CAAC0C,QAAN;AACD,KA7DD,CA6DE,OAAO5B,GAAP,EAAY;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBF,GAAzB;AACAX,MAAAA,UAAU,CAAC,KAAD,CAAV;AACD;AACF,GAlED;;AAoEA,QAAM;AAAA,OAACqC,YAAD;AAAA,OAAeG;AAAf,MAAkChD,QAAQ,CAAC,EAAD,CAAhD;AACA,QAAM;AAAA,OAAC4C,YAAD;AAAA,OAAeK;AAAf,MAAkCjD,QAAQ,CAAC,EAAD,CAAhD;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACd,UAAMiD,SAAS,GAAGpC,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAlB;AACA,QAAIoC,YAAY,GAAGC,IAAI,CAACC,KAAL,CAAWH,SAAX,CAAnB;;AACA,QAAIC,YAAJ,EAAkB;AAChB,UAAIG,QAAQ,GAAGxD,MAAM,CAACO,KAAK,CAACkD,gBAAP,CAAN,CACZnB,EADY,CACTe,YAAY,CAACK,QADJ,EAEZC,MAFY,CAEL,IAFK,CAAf;AAGA,UAAIxB,IAAI,GAAGnC,MAAM,CAACO,KAAK,CAACkD,gBAAP,CAAN,CAA+BE,MAA/B,CAAsC,eAAtC,CAAX;;AACA,UAAIxB,IAAJ,EAAU;AACRe,QAAAA,eAAe,CAACf,IAAD,CAAf;AACD;;AACD,UAAIqB,QAAJ,EAAc;AACZL,QAAAA,eAAe,CAACK,QAAD,CAAf;AACD;AACF;;AACD,QAAIjD,KAAK,CAACqD,QAAV,EAAoB;AAClB,YAAMR,SAAS,GAAGpC,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAlB;AACA,UAAIoC,YAAY,GAAGC,IAAI,CAACC,KAAL,CAAWH,SAAX,CAAnB;;AACA,UAAIC,YAAY,CAACQ,MAAjB,EAAyB;AACvBjD,QAAAA,UAAU,CAAC;AAAEC,UAAAA,QAAQ,EAAE,SAAZ;AAAuBF,UAAAA,OAAO,EAAE0C,YAAY,CAAC1C;AAA7C,SAAD,CAAV;AACD,OAFD,MAEO;AACLC,QAAAA,UAAU,CAAC;AACTC,UAAAA,QAAQ,EACNN,KAAK,CAACiB,WAAN,IACAjB,KAAK,CAACiB,WAAN,CAAkBI,MADlB,IAEArB,KAAK,CAACiB,WAAN,CAAkBI,MAAlB,CAAyBkC,IAJlB;AAKTnD,UAAAA,OAAO,EACLJ,KAAK,CAACiB,WAAN,IACAjB,KAAK,CAACiB,WAAN,CAAkBI,MADlB,IAEArB,KAAK,CAACiB,WAAN,CAAkBI,MAAlB,CAAyBC;AARlB,SAAD,CAAV;AAUD;AACF;AACF,GAjCQ,EAiCN,CAACtB,KAAK,CAACqD,QAAP,CAjCM,CAAT;AAmCA,sBACE;AAAK,IAAA,KAAK,EAAE;AAAEG,MAAAA,OAAO,EAAG,GAAExD,KAAK,CAACyD,WAAN,KAAsB,CAAtB,GAA0B,OAA1B,GAAoC,MAAO;AAAzD,KAAZ;AAAA,2BACE;AAAK,MAAA,SAAS,EAAC,gFAAf;AAAA,6BACE;AAAK,QAAA,SAAS,EAAC,oBAAf;AAAA,+BACE;AAAA,kCACE;AAAI,YAAA,SAAS,EAAC,iBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE;AAAK,YAAA,SAAS,EAAC,KAAf;AAAA,oCACE;AAAK,cAAA,SAAS,EAAC,yCAAf;AAAA,qCACE;AAAA,uCACE;AACE,kBAAA,SAAS,EAAC,YADZ;AAEE,kBAAA,GAAG,EACDrD,OAAO,CAACE,QAAR,KAAqB,SAArB,GACK,kCAAiCoD,MAAM,CACtCtD,OAAO,CAACA,OAD8B,CAEtC,sCAHN,GAIIJ,KAAK,CAACiB,WAAN,IACAjB,KAAK,CAACiB,WAAN,CAAkBI,MADlB,IAEArB,KAAK,CAACiB,WAAN,CAAkBI,MAAlB,CAAyBsC,WATjC;AAWE,kBAAA,KAAK,EAAC,KAXR;AAYE,kBAAA,MAAM,EAAC,KAZT;AAaE,kBAAA,WAAW,EAAC,GAbd;AAcE,kBAAA,eAAe,EAAC,EAdlB;AAeE,iCAAY,OAfd;AAgBE,kBAAA,QAAQ,EAAC;AAhBX;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,oBADF,eA2BE;AAAK,cAAA,SAAS,EAAC,sCAAf;AAAA,sCACE;AAAK,gBAAA,SAAS,EAAC,YAAf;AAAA,0BACG3D,KAAK,CAAC4D,eAAN,IAAyB5D,KAAK,CAAC4D,eAAN,CAAsBvC,MAA/C,iBACC,QAAC,KAAD;AACE,kBAAA,KAAK,EAAE;AAAEwC,oBAAAA,YAAY,EAAE;AAAhB,mBADT;AAEE,kBAAA,GAAG,EACD7D,KAAK,CAAC4D,eAAN,IACA5D,KAAK,CAAC4D,eAAN,CAAsBvC,MADtB,IAEArB,KAAK,CAAC4D,eAAN,CAAsBvC,MAAtB,CAA6B/B,KAA7B,CAAmC,CAAnC,EAAsCwE,GAL1C;AAOE,kBAAA,GAAG,EAAC,EAPN;AAQE,kBAAA,MAAM,EAAE,GARV;AASE,kBAAA,KAAK,EAAE,GATT,CAUE;;AAVF;AAAA;AAAA;AAAA;AAAA;AAFJ;AAAA;AAAA;AAAA;AAAA,sBADF,eAiBE;AAAK,gBAAA,SAAS,EAAC,YAAf;AAAA,wCACE;AAAA,4BAAI1D,OAAO,IAAIA,OAAO,CAACE;AAAvB;AAAA;AAAA;AAAA;AAAA,wBADF,eAEE;AAAA,4BAAIF,OAAO,IAAIA,OAAO,CAACA;AAAvB;AAAA;AAAA;AAAA;AAAA,wBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,sBAjBF,eAqBE;AAAK,gBAAA,SAAS,EAAC,aAAf;AAAA,wCACE;AAAK,kBAAA,SAAS,EAAC,qBAAf;AAAA,kCAAuCoC,YAAvC;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF,eAEE;AAAK,kBAAA,SAAS,EAAC,mBAAf;AAAA,4BACGD,YAAY,GAAGA,YAAY,CAACwB,WAAb,EAAH,GAAgC;AAD/C;AAAA;AAAA;AAAA;AAAA,wBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,sBArBF;AAAA;AAAA;AAAA;AAAA;AAAA,oBA3BF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFF,eA0DE;AAAK,YAAA,SAAS,EAAC,eAAf;AAAA,mCACE;AAAK,cAAA,SAAS,EAAC,QAAf;AAAA,sCACE;AACE,gBAAA,IAAI,EAAC,QADP;AAEE,gBAAA,SAAS,EAAExE,SAAS,CAACyE,SAFvB;AAGE,gBAAA,OAAO,EAAE,MAAM;AACbhE,kBAAAA,KAAK,CAACiE,aAAN,CAAoB,IAApB;AACAjE,kBAAAA,KAAK,CAACkE,aAAN,CAAoB,IAApB;AACAlE,kBAAAA,KAAK,CAACyC,WAAN,CAAkB,CAAlB;AACAzC,kBAAAA,KAAK,CAACmE,iBAAN,CAAwB,KAAxB;AAEAnE,kBAAAA,KAAK,CAACoE,QAAN,CAAe,CAAf;AACD,iBAVH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBADF,eAeE;AACE,gBAAA,IAAI,EAAC,QADP;AAEE,gBAAA,SAAS,EAAE7E,SAAS,CAAC8E,OAFvB;AAGE,gBAAA,OAAO,EAAE,MAAM9D,uBAAuB,EAHxC;AAIE,gBAAA,QAAQ,EAAEL,OAJZ;AAAA,0BAMGA,OAAO,gBACN,QAAC,WAAD;AAAa,kBAAA,IAAI,EAAC,yBAAlB;AAA4C,kBAAA,IAAI;AAAhD;AAAA;AAAA;AAAA;AAAA,wBADM,GAGN;AATJ;AAAA;AAAA;AAAA;AAAA,sBAfF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,kBA1DF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,UADF;AAiGD,CApPD;;AAsPA,eAAeH,gBAAf","sourcesContent":["/** @format */\nimport Image from 'next/image';\nimport btnStyles from './../../styles/Btn.module.css';\nimport Axios from 'axios';\nimport moment from 'moment';\nimport React, { useState, useEffect } from 'react';\nimport { useUserData } from '../../contexts/UserDataContext';\nimport FontAwesome from 'react-fontawesome';\n\nconst ConfirmTestDrive = (props) => {\n  const data = useUserData();\n\n  const [loading, setLoading] = useState(false);\n\n  const [address, setAddress] = useState({ address: '', location: '' });\n\n  // const sendTextMessage = (userData) => {\n  //   const textMessageData = {\n  //     firstName: userData.fields.FirstName,\n  //     lastName: userData.fields.LastName,\n  //     date: userData.fields.Date,\n  //     phone: userData.fields.Phone,\n  //   };\n  //   Axios.post('/api/sendTextMessage', textMessageData)\n  //     .then((res) => {\n  //       console.log('sent text message ', res.data);\n  //       localStorage.clear();\n  //     })\n  //     .catch((err) => {\n  //       console.log(err);\n  //       localStorage.clear();\n  //     });\n  // };\n\n  const sendConfirmationMessage = async (\n    userId = localStorage.getItem('userId')\n  ) => {\n    setLoading(true);\n    let userData;\n    try {\n      userData = await Axios.get(`/api/user/get-user/${userId}`);\n      // console.log(userData.data);\n      createEvent(userData.data);\n    } catch (err) {\n      console.log(err);\n    }\n    // if (userData.data && userData.data.fields) {\n    //   createEvent(userData.data);\n    // }\n  };\n  const createEvent = async (userData) => {\n    try {\n      const rooftopData = await Axios.get(`/api/get-rooftop/${props.rt}`);\n      const carData = await Axios.get(\n        `/api/get-car/${localStorage.getItem('carId')}`\n      );\n      const dealerData = await Axios.get(\n        `/api/get-dealership/${rooftopData.data.fields['Dealership Group'][0]}`\n      );\n\n      const location =\n        userData.fields &&\n        userData.fields['At Home'] &&\n        userData.fields['At Home'] === true\n          ? userData.fields.Address\n          : rooftopData.data.fields.Address;\n\n      let dateVal = Math.floor(new Date().getTime() / 1000.0);\n      let date = moment.unix(dateVal);\n      let dateEpoch = date.tz(rooftopData.data.fields.Timezone).unix();\n\n      let userSelectedDate = moment(new Date(userData.fields.Date));\n      let selectedDateEpoch = userSelectedDate\n        .tz(rooftopData.data.fields.Timezone)\n        .unix()\n        .toString();\n\n      let currentTimeDifference = Math.floor(\n        (selectedDateEpoch - dateEpoch) / 60\n      ).toString();\n\n      // console.log(\n      //   'log date FE ',\n      //   typeof dateEpoch,\n      //   typeof selectedDateEpoch,\n      //   typeof currentTimeDifference\n      // );\n\n      const setEvent = await Axios.post('/api/user/createEvent', {\n        location,\n        userData,\n        carData: carData.data,\n        rooftopData: rooftopData.data,\n        dealerData,\n        selectedTime,\n        selectedDate,\n        currentTimeDifference,\n        selectedDateEpoch,\n      });\n\n      // const setEvent = await Axios.post('/api/user/nylusTest', {\n      //   location,\n      //   userData,\n      //   carData: carData.data,\n      //   rooftopData: rooftopData.data,\n      //   dealerData,\n      //   selectedTime,\n      //   selectedDate,\n      // });\n      setLoading(false);\n      props.setThisPage(9);\n      props.nextStep();\n    } catch (err) {\n      console.log('error log', err);\n      setLoading(false);\n    }\n  };\n\n  const [selectedDate, setSelectedDate] = useState('');\n  const [selectedTime, setSelectedTime] = useState('');\n\n  useEffect(() => {\n    const driveForm = localStorage.getItem('driveForm');\n    let dupDriveForm = JSON.parse(driveForm);\n    if (dupDriveForm) {\n      let timeSlot = moment(props.selectedDateTime)\n        .tz(dupDriveForm.timeZone)\n        .format('LT');\n      let date = moment(props.selectedDateTime).format('dddd, MMMM DD');\n      if (date) {\n        setSelectedDate(date);\n      }\n      if (timeSlot) {\n        setSelectedTime(timeSlot);\n      }\n    }\n    if (props.isActive) {\n      const driveForm = localStorage.getItem('driveForm');\n      let dupDriveForm = JSON.parse(driveForm);\n      if (dupDriveForm.atHome) {\n        setAddress({ location: 'At Home', address: dupDriveForm.address });\n      } else {\n        setAddress({\n          location:\n            props.rooftopData &&\n            props.rooftopData.fields &&\n            props.rooftopData.fields.Name,\n          address:\n            props.rooftopData &&\n            props.rooftopData.fields &&\n            props.rooftopData.fields.Address,\n        });\n      }\n    }\n  }, [props.isActive]);\n\n  return (\n    <div style={{ display: `${props.currentPage === 8 ? 'block' : 'none'}` }}>\n      <div className=\"container-fluid bggray d-flex justify-content-center height100vh overflow-auto\">\n        <div className=\"bgwhite centerDiv1\">\n          <div>\n            <h1 className=\"confirm-heading\">Confirm your Test Drive</h1>\n            <div className=\"row\">\n              <div className=\"col-sm-12 col-md-6 col-lg-6 displaynone\">\n                <div>\n                  <iframe\n                    className=\"confirmMap\"\n                    src={\n                      address.location === 'At Home'\n                        ? `https://maps.google.com/maps?q=${escape(\n                            address.address\n                          )}&t=&z=13&ie=UTF8&iwloc=&output=embed`\n                        : props.rooftopData &&\n                          props.rooftopData.fields &&\n                          props.rooftopData.fields.Geolocation\n                    }\n                    width=\"600\"\n                    height=\"420\"\n                    frameBorder=\"0\"\n                    allowFullScreen=\"\"\n                    aria-hidden=\"false\"\n                    tabIndex=\"0\"\n                  ></iframe>\n                </div>\n\n                {/* <div className=\"infoText\">\n              <p>*you can change your appointment time if needed</p>\n            </div> */}\n              </div>\n              <div className=\"col-sm-12 col-md-6 col-lg-6 ipadView\">\n                <div className=\"confirmCar\">\n                  {props.selectedCarData && props.selectedCarData.fields && (\n                    <Image\n                      style={{ borderRadius: '20px' }}\n                      src={\n                        props.selectedCarData &&\n                        props.selectedCarData.fields &&\n                        props.selectedCarData.fields.Image[0].url\n                      }\n                      alt=\"\"\n                      height={350}\n                      width={600}\n                      // width=\"100%\"\n                    />\n                  )}\n                </div>\n                <div className=\"mapAddress\">\n                  <p>{address && address.location}</p>\n                  <p>{address && address.address}</p>\n                </div>\n                <div className=\"confirmDate\">\n                  <div className=\"monthandDateContent\"> {selectedDate}</div>\n                  <div className=\"timeVIewContainer\">\n                    {selectedTime ? selectedTime.toLowerCase() : null}\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div className=\"btnSecconfirm\">\n              <div className=\"flexBt\">\n                <button\n                  type=\"button\"\n                  className={btnStyles.secondary}\n                  onClick={() => {\n                    props.setImageFile2(null);\n                    props.setImageFile1(null);\n                    props.setThisPage(4);\n                    props.setSomethingWrong(false);\n\n                    props.goToStep(4);\n                  }}\n                >\n                  Back\n                </button>\n                <button\n                  type=\"button\"\n                  className={btnStyles.primary}\n                  onClick={() => sendConfirmationMessage()}\n                  disabled={loading}\n                >\n                  {loading ? (\n                    <FontAwesome name=\"fas fa-spinner fa-pulse\" spin />\n                  ) : (\n                    'Continue'\n                  )}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ConfirmTestDrive;\n"]},"metadata":{},"sourceType":"module"}