!function(){var e=this,t=e.DDC,n=e.jQuery,a={facetBrowseParent:".inventory-search-facetbrowse",facetBrowseWidget:"[data-widget-name]:has([name=facetbrowse])",form:"form:has([name=facetbrowse])",refresh:"[data-widget-name]:has([name=facetbrowse]) .refresh",select:"select",unsatisfiedDependent:".unsatisfiedDependent",option:"option",input:":input:not([type=submit])",submit:"[type=submit]",listingConfigId:"[name=listingConfigId]",rangeField:":input.minmax",minRangeField:".min-range",maxRangeField:".max-range",ddcRow:".yui3-g, .row",loading:".loading",widgetId:"[data-widget-id]",selected:'.inventory-search-facetbrowse select[name="compositeType"] option',compositeType:'.inventory-search-facetbrowse select[name="compositeType"]',resetSearch:".reset-search",inputPreserveOnBack:"input[name=preserveSelectsOnBack]",formPreserveOnBack:"form:has([name=facetbrowse]):has([name=preserveSelectsOnBack])",newListingPage:"input[name=newListingAlias]",usedListingPage:"input[name=usedListingAlias]",certifiedListingPage:"input[name=certifiedListingAlias]",paymentSelectionToggle:"[name=payment-selection]",paymentSliderElement:".inventory-search-facetbrowse .ui-slider",baseLeaseMin:"[name=default-monthly-payment-lease-min]",baseLeaseMax:"[name=default-monthly-payment-lease-max]",baseLoanMin:"[name=default-monthly-payment-loan-min]",baseLoanMax:"[name=default-monthly-payment-loan-max]"},r={page:{facetbrowseRefresh:"facetbrowse-refresh",updateRanges:"update-ranges",startLoading:"start-loading",stopLoading:"stop-loading",watchUpdateRequests:"watch-update-requests",watchDisableRequests:"watch-disable-request",watchEnableRequests:"watch-enable-requests"},user:{selectChange:"change",rangeChange:"change",refreshClick:"click",resetSearch:"click",submitOnEnter:"keyup",paymentSelectionChange:"change",paymentSliderChange:"sliderstop",formSubmit:"submit"}},o={user:{live:{refreshClick:a.refresh,selectChange:a.facetBrowseParent+" "+a.form+" "+a.select,rangeChange:a.facetBrowseParent+" "+a.rangeField,resetSearch:a.resetSearch,submitOnEnter:a.facetBrowseParent+" "+a.submit,paymentSelectionChange:a.paymentSelectionToggle,paymentSliderChange:a.paymentSliderElement,formSubmit:a.facetBrowseParent+" "+a.form},traditional:{}}},s={load:"BLANK",linkToConditionPages:!1},m={enter:13,monthPaymentLeaseMin:1===n(a.facetBrowseParent+" "+a.baseLeaseMin).length?n(a.facetBrowseParent+" "+a.baseLeaseMin).val():-1,monthPaymentLeaseMax:1===n(a.facetBrowseParent+" "+a.baseLeaseMax).length?n(a.facetBrowseParent+" "+a.baseLeaseMax).val():-1,monthPaymentLoanMin:1===n(a.facetBrowseParent+" "+a.baseLoanMin).length?n(a.facetBrowseParent+" "+a.baseLoanMin).val():-1,monthPaymentLoanMax:1===n(a.facetBrowseParent+" "+a.baseLoanMax).length?n(a.facetBrowseParent+" "+a.baseLoanMax).val():-1},c=function(){},f=function(e,t){if(e)for(e="object"!=typeof e?[e]:e,i=0;i<e.length;i++)n(e[i]).find(a.select+", "+a.input).not(a.unsatisfiedDependent).removeAttr("disabled"),n(e[i]).find(a.submit).removeAttr("disabled"),t===!0&&n(document).trigger("facetBrowseEnableComplete",[{form:n(e[i])}])},d=function(e,t){if(e){var e="object"!=typeof e?[e]:e;for(i=0;i<e.length;i++)n(e[i]).find(a.select+", "+a.input).attr("disabled","disabled"),n(e[i]).find(a.submit).attr("disabled","disabled"),t===!0&&n(document).trigger("facetBrowseDisableComplete",[{form:n(e[i])}])}},l=function(e){return e?e.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1"):e},g=function(){var e=n(this).parents(a.form).find('[selected="selected"]');n(document).trigger("trackEvent",[{widgetName:"index-facetbrowse",eventName:"click",data:"Search",value:parseInt(e.length,10)}])},u={page:{facetbrowseRefresh:function(e,i){var o,p,h,y,b;i&&i.url?o=i.url:i&&i.form&&(n(i.form).find(a.listingConfigId).size()&&(o=n.getDataAttributes(n(i.form).find(a.listingConfigId).find(a.option+"[value="+l(n(i.form).find(a.listingConfigId).val())+"]")).refresh),p=i.queryString||n(i.form).serialize()),h=o.toString().indexOf("?")>0?o.toString().split("?")[0]:o,y=n.extend({},t.getUrlParams(o),t.getUrlParams("?"+p)),y.key="DDC.inventory.lastSearchQuery",n(document).trigger("setInventorySearchCookie",y),y.key="DDC.inventory.facetBrowseQuery",n(document).trigger("setInventorySearchCookie",y),b=void 0!==i.widgetId?i.widgetId:n(i.form).parents(a.widgetId).first().attr("data-widget-id"),h&&(n(document).trigger(r.page.startLoading,[{refreshUrl:h,queryData:y,widgetId:b}]),d([i.form,a.form],!1),void 0!==y["payment-selection"]&&(-1!=y["payment-selection"].indexOf("paymentLease")&&void 0===y.paymentLease?-1!==m.monthPaymentLeaseMin&&-1!==m.monthPaymentLeaseMax?(y.paymentLease=m.monthPaymentLeaseMin+"-"+m.monthPaymentLeaseMax,delete y.paymentLoan):-1!==m.monthPaymentLeaseMin&&(y.paymentLease=m.monthPaymentLeaseMin+"-",delete y.paymentLoan):-1!=y["payment-selection"].indexOf("paymentLoan")&&void 0===y.paymentLoan?-1!==m.monthPaymentLoanMin&&-1!==m.monthPaymentLoanMax?(y.paymentLoan=m.monthPaymentLoanMin+"-"+m.monthPaymentLoanMax,delete y.paymentLease):-1!==m.monthPaymentLoanMin&&(y.paymentLoan=m.monthPaymentLoanMin+"-",delete y.paymentLease):-1!=y["payment-selection"].indexOf("payment-panel-all")&&(delete y.paymentLease,delete y.paymentLoan)),n.ajax({url:h,data:y,success:function(e){var t=n(e).find(".facetbrowse-ajax-form"),i=n(a.facetBrowseParent+'[data-widget-id="'+b+'"]').find(".facetbrowse-ajax-form");i.replaceWith(t),n(document).trigger("modulesRefresh"),c()},complete:function(){f([i.form,a.form],!1),n(document).trigger(r.page.stopLoading),n(a.submit).on("click",g),s.linkToConditionPages&&u.page.removeListingConfigId()}}))},removeListingConfigId:function(){n(a.form).submit(function(){n(a.listingConfigId).remove()})},updateRanges:function(){var e,t;n(a.rangeField).each(function(){e={form:n(this).parents(a.form),name:n(this).attr("name").replace(/(min-)|(max-)/,""),min:n(this).parents(a.ddcRow).find(a.minRangeField).val().replace(/[^0-9]*/g,"")||"",max:n(this).parents(a.ddcRow).find(a.maxRangeField).val().replace(/[^0-9]*/g,"")||""},t=e.min+(e.min||e.max?"-":"")+e.max,n(e.form).find("[name="+e.name+"]").size()||n(e.form).append('<input type="hidden" class="hide" name="'+e.name+'" />'),n(e.form).find("[name="+e.name+"]").val(t)})},startLoading:function(e,t){n(e.target).each(function(){n('<div class="loading">&nbsp;</div>').css({position:"absolute",minWidth:"50px",minHeight:"50px"}).appendTo(this).position({of:n(this),my:"center center",at:"center center",offset:"0 0"})}),n(document).trigger("facetBrowseStartLoading",t)},stopLoading:function(){if(n(a.facetBrowseWidget).find(a.loading).remove(),n(document).trigger("facetBrowseStopLoading"),s.linkToConditionPages){var e=n(a.compositeType).get(0),t=e[e.selectedIndex].value;"new"==t?n(a.form).attr("action",n(a.newListingPage).val()):"used"==t?n(a.form).attr("action",n(a.usedListingPage).val()):"certified"==t&&n(a.form).attr("action",n(a.certifiedListingPage).val())}},watchUpdateRequests:function(){n(document).bind("facetBrowseRefreshRequest",function(e,t){n(document).trigger(r.page.facetbrowseRefresh,[t])})},watchDisableRequests:function(){n(document).bind("facetBrowseDisableRequest",function(e,t){t.reply&&void 0!==t.reply||(t.reply=!1),d(t.form,t.reply)})},watchEnableRequests:function(){n(document).bind("facetBrowseEnableRequest",function(e,t){t.reply&&void 0!==t.reply||(t.reply=!1),f(t.form,t.reply)})},prepPaymentSliders:function(e){var t=e.parents(a.form),i={},r=t.find(".monthly-payment-toggle").attr("name"),o="paymentLease"==r?"paymentLoan":"paymentLease";n(".ui-slider").each(function(){var e=n(this).siblings("input").eq(0).attr("name"),t=n(this).slider("option","values");i["min"+e]=t[0],i["max"+e]=t[1]});var s=i["min"+r]+"-"+i["max"+r],m="";n(a.paymentSelectionToggle).val("payment-panel-"+r),n("input[name="+r+"]").val(s),n("input[name="+o+"]").val(m)}},user:{selectChange:function(e){var t=n(this).parents(a.form),i={form:t};return"make"===n(e.target).attr("name")&&""===n(e.target).attr("value")&&t.find('select[name="model"]').val(""),"payment-selection"!==n(e.target).attr("name")&&n(document).trigger(r.page.facetbrowseRefresh,[i]),!1},rangeChange:function(){n(document).trigger("update-ranges")},resetSearch:function(e){if(!n(e.target).hasClass("no-js-refresh")&&!n(e.target).closest("a").hasClass("no-js-refresh")){var t={url:n(this).attr("href")+"?"+n(this).closest("form").find(":input").not("select").serialize(),form:n(this).closest("form")};return n(document).trigger(r.page.facetbrowseRefresh,[t]),!1}},refreshClick:function(){var e={url:n(this).attr("href"),form:n(this).parents(a.facetBrowseWidget).find(a.form)};return n(document).trigger(r.page.facetbrowseRefresh,[e]),!1},submitOnEnter:function(e){e.which===m.enter&&n(a.facetBrowseParent+" "+a.form).submit()},formSubmit:function(){n(a.form).find("input[name=payment-selection]").hasClass("hidden")&&!n(a.form).find(".monthly-payment-toggle").hasClass("manipulated")&&n(a.form).find(".monthly-payment-toggle").val("")},paymentSelectionChange:function(){var e=n(this).parents(a.form),t={form:e};n(document).trigger(r.page.facetbrowseRefresh,[t])},paymentSliderChange:function(){var e=n(this).parents(a.form),t={form:e};u.page.prepPaymentSliders(n(this)),n(document).trigger(r.page.facetbrowseRefresh,[t])}}},p={resetMonthlyPaymentRadios:function(){n(a.paymentSelectionToggle).prop("checked",!1)},enableForm:function(){n(a.form).each(function(){f(n(this))}),n(a.newListingPage).size()>0&&(s.linkToConditionPages=!0)},rangeFields:function(){n(document).trigger(r.page.updateRanges)},initializeExternal:function(){n(document).trigger(r.page.watchUpdateRequests),n(document).trigger(r.page.watchDisableRequests),n(document).trigger(r.page.watchEnableRequests)},initializeFromBackButton:function(){var e=n(a.formPreserveOnBack);if("true"===n(a.inputPreserveOnBack,e).val()){var t=!1;if(n("select:visible",e).each(function(){t||""===n(this).val()||(t=!0)}),t){var i=n.cookie("DDC.inventory.facetBrowseQuery"),o={form:e,queryString:i};n(document).trigger(r.page.facetbrowseRefresh,[o])}}},initBindings:function(){n(a.submit).on("click",g),n(a.facetBrowseParent).on("click",a.submit,function(){n(this).parents(a.form);u.page.prepPaymentSliders(n(this))})}};c=function(){n.each(o.user.traditional,function(e){n(o.user.traditional[e]).unbind(r.user[e]).bind(r.user[e],u.user[e])})},n(function(){var e=n(".inventory-search-facetbrowse select:visible:eq(0)")[0];n.each(r.page,function(e){n(document).bind(r.page[e],u.page[e])}),n.each(o.user.live,function(e){n(o.user.live[e]).die(r.user[e]).live(r.user[e],u.user[e])}),c(),n.each(p,function(e){n.isFunction(p[e])&&p[e]()}),"undefined"!=typeof e&&(e.selectedIndex=0)})}();